---
- name: Set DNS servers for specific connection
  community.general.nmcli:
    conn_name: "{{ connection_name }}"
    type: ethernet
    dns4: "{{ dns_servers }}"
    dns4_search: "{{ search_domain }}"
    dns4_ignore_auto: yes
    state: present

- name: Ensure the SSH service is installed
  ansible.builtin.package:
    name: openssh-server
    state: present

- name: Configure SSH to permit root login
  ansible.builtin.template:
    src: sshd_config.j2
    dest: /etc/ssh/sshd_config
    owner: root
    group: root
    mode: '0644'
  notify: restart sshd

- name: Restart specific network connection
  ansible.builtin.command:
    cmd: "nmcli con down '{{ connection_name }}' && nmcli con up '{{ connection_name }}'"

